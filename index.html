<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è¨˜å¸³ Â· åœ“å½¢å‹•æ…‹æ¥µç°¡ v3.2ï¼ˆæ·±è‰²/ç»ç’ƒ/æ»‘å‹•ï¼‰</title>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Charts & Excel (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root{
      --bg: #f7fbfa;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --brand: #22b7a6;
      --brand-2: #60d1c6;
      --accent: #3da9f5;
      --danger: #ef4444;
      --ok: #10b981;
      --radius: 18px;
      --shadow: 0 10px 24px rgba(0,0,0,.08);
      --shadow-sm: 0 6px 14px rgba(0,0,0,.06);
      --line: #e9f0ef;
      --soft: #f0f7f6;
      --table-head: #f0faf7;
      --chip-exp: #ef4444;
      --chip-inc: #10b981;
      --canvas-grid: #d9e6e3;
    }
    body.dark{
      --bg: #0f1720;
      --card: #0f1b22;
      --text: #e5eef2;
      --muted: #98a4ab;
      --brand: #2ed3c6;
      --brand-2: #60d1c6;
      --accent: #69b8ff;
      --danger: #f87171;
      --ok: #34d399;
      --shadow: 0 10px 24px rgba(0,0,0,.35);
      --shadow-sm: 0 6px 14px rgba(0,0,0,.28);
      --line: #17303a;
      --soft: #0e2227;
      --table-head: #0e2329;
      --canvas-grid: #233943;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, 'Noto Sans TC', system-ui, -apple-system, Segoe UI, Roboto, 'PingFang TC', 'Microsoft JhengHei', Arial, sans-serif;
      letter-spacing:.2px;
      background:
        radial-gradient(1100px 520px at -10% -10%, rgba(232,251,245,.8) 0%, transparent 50%) no-repeat,
        radial-gradient(900px 480px at 110% 0%, rgba(234,245,255,.8) 0%, transparent 55%) no-repeat,
        linear-gradient(180deg, var(--bg), var(--soft));
      color: var(--text);
      transition: background .3s ease, color .2s ease;
    }
    body.dark{
      background:
        radial-gradient(1000px 500px at -20% -30%, rgba(29,71,69,.6) 0%, transparent 55%) no-repeat,
        radial-gradient(900px 520px at 120% -10%, rgba(29,50,83,.55) 0%, transparent 55%) no-repeat,
        linear-gradient(180deg, var(--bg), #0a1317);
    }
    .wrap{max-width: 1080px; margin: 26px auto 140px; padding: 0 16px;}
    .titleRow{display:flex; align-items:center; gap:14px; margin-bottom:14px}
    .logo{width:50px;height:50px;border-radius:50%;
      background: conic-gradient(from 210deg at 50% 50%, var(--brand), var(--accent), var(--brand-2), var(--brand));
      box-shadow: var(--shadow);
      position: relative; overflow:hidden;
    }
    .logo::after{content:''; position:absolute; inset:0; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 40%); mix-blend-mode: screen;}
    h1{font-size:22px; margin:0 0 2px; letter-spacing:.5px; font-weight:800}
    .tagline{color:var(--muted); font-size:13px}

    .grid{display:grid; grid-template-columns: 1fr; gap:16px}
    @media(min-width:900px){ .grid{grid-template-columns: 1.1fr .9fr} }

    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; border:1px solid var(--line); transition: background .25s ease, border-color .25s ease, box-shadow .25s ease}
    body.glass .card{
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.35);
      backdrop-filter: saturate(160%) blur(14px);
    }
    body.dark.glass .card{
      background: rgba(15, 27, 34, .55);
      border-color: rgba(255,255,255,.12);
      backdrop-filter: saturate(160%) blur(14px);
    }

    .card h2{margin:0 0 10px; font-size:18px; display:flex; align-items:center; gap:8px; font-weight:800}
    .chip{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; color:#fff; background:linear-gradient(135deg, var(--brand), var(--accent)); box-shadow:var(--shadow-sm)}

    .row{display:flex; flex-wrap:wrap; gap:10px}
    .row > *{flex:1 1 160px}
    label{font-size:12px; color:var(--muted); display:block; margin:2px 4px}
    input, select{
      width:100%; border:1px solid #e6ecea; background:#fbfefc;
      padding:10px 12px; border-radius:12px; outline:none; font-size:14px;
      position:relative; z-index:1; pointer-events:auto;
    }
    body.dark input, body.dark select{ background:#0a1317; border-color:#1f3640; color:var(--text); }
    input:focus, select:focus{border-color: var(--brand); box-shadow:0 0 0 3px rgba(34,183,166,.14)}

    .circle{
      --size:52px;
      width:var(--size); height:var(--size);
      border-radius:50%;
      display:inline-grid; place-items:center;
      color:#fff; border:none; cursor:pointer; user-select:none;
      background: linear-gradient(135deg, var(--brand), var(--accent));
      box-shadow: 0 10px 18px rgba(61,169,245,.25), inset 0 -2px 6px rgba(0,0,0,.12);
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease, background .2s ease;
      position:relative; overflow:hidden;
      font-weight:700;
    }
    .circle:hover{ transform: translateY(-2px) scale(1.02); filter: brightness(1.04); }
    .circle:active{ transform: translateY(0) scale(.97); }
    .circle.secondary{ background: linear-gradient(135deg, #60a5fa, #3b82f6); }
    .circle.ok{ background: linear-gradient(135deg, #34d399, #10b981); }
    .circle.danger{ background: linear-gradient(135deg, #f87171, #ef4444); }
    .circle.ghost{ background:#fff; color:var(--text); border:1px dashed #d1d5db; box-shadow: var(--shadow-sm); }
    body.dark .circle.ghost{ background:#0a1317; border-color:#2b3f47; color:var(--text); }

    .circle::before{ content:''; position:absolute; width:0; height:0; border-radius:50%; background: rgba(255,255,255,.35); left:50%; top:50%; transform:translate(-50%,-50%); opacity:0; }
    .circle:active::before{ width:160%; height:160%; opacity:1; transition: width .22s ease-out, height .22s ease-out, opacity .5s ease; }

    .mini{ --size:36px; font-size:14px }
    .toolrow{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:8px}

    .segs{display:flex; flex-wrap:wrap; gap:8px; margin-top:4px}
    .seg{ display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px; background:#f5fbfa; border:1px solid #e6f3f0; color:#0f766e; font-size:13px; cursor:pointer; transition:.15s; user-select:none; }
    body.dark .seg{ background:#0e2227; border-color:#17303a; color:#86e1d8; }
    .seg:hover{filter: brightness(1.03)}
    .seg.active{ background:linear-gradient(135deg, var(--brand), var(--accent)); color:#fff; border-color: transparent; box-shadow:var(--shadow-sm) }

    .stats{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:10px}
    .stat{background:#f6fbfa; border:1px solid #e6f3f0; border-radius:14px; padding:12px}
    body.dark .stat{ background:#0e2227; border-color:#17303a; }
    .stat .label{font-size:12px; color:var(--muted)}
    .stat .val{font-weight:800; margin-top:2px; font-size:18px}

    .tableWrap{max-height: 420px; overflow:auto; border:1px solid var(--line); border-radius:12px}
    table{width:100%; border-collapse:collapse; font-size:14px}
    thead th{position:sticky; top:0; background:var(--table-head); border-bottom:1px solid var(--line); padding:10px; font-weight:600}
    tbody td{border-bottom:1px solid rgba(0,0,0,.04); padding:10px; vertical-align:top}
    body.dark tbody td{border-bottom-color:#15262c}
    .typeChip{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; color:#fff}
    .chip-exp{background:var(--chip-exp)}
    .chip-inc{background:var(--chip-inc)}
    .ops{display:flex; gap:6px}

    tbody tr{ position:relative; touch-action: pan-y; transition: transform .2s ease; background: transparent; }
    .swipeActs{ position:absolute; right:8px; top:50%; transform:translateY(-50%); display:flex; gap:8px; opacity:0; pointer-events:none; }
    .swipe-open .swipeActs{ opacity:1; pointer-events:auto; }
    @media(max-width: 720px){ thead th:last-child, tbody td:last-child{ display:none; } }

    details{margin-top:12px}
    summary{cursor:pointer; padding:8px 12px; border-radius:12px; background:var(--table-head); border:1px solid var(--line); user-select:none}
    canvas{max-height: 320px}

    .fab-wrap{position:fixed; right:18px; bottom:18px; z-index:99}
    .fab-main{--size:64px; font-size:22px; background: radial-gradient(circle at 35% 30%, #fff6, transparent 40%), linear-gradient(135deg, var(--brand), var(--accent));}
    .fab-menu{position:absolute; right:8px; bottom:76px; display:grid; gap:10px; opacity:0; pointer-events:none; transform: translateY(8px); transition:.2s}
    .fab-wrap.open .fab-menu{opacity:1; pointer-events:auto; transform: translateY(0)}
    .fab-item{display:flex; align-items:center; gap:8px; justify-content:flex-end}
    .fab-label{background:#111827; color:#fff; font-size:12px; padding:6px 8px; border-radius:10px; box-shadow:var(--shadow-sm)}

    .panel{ position:fixed; top:16px; right:16px; z-index:100; width:min(92vw, 360px); display:none; }
    .panel.open{ display:block; }
    .panel .inner{ background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); padding:12px }
    body.glass .panel .inner{ background: rgba(255,255,255,.75); backdrop-filter: blur(12px); }
    body.dark.glass .panel .inner{ background: rgba(15,27,34,.75); }
    .panel h3{ margin:4px 0 8px; font-size:14px }
    .panel .row{ gap:8px }
    .panel .close{ position:absolute; top:-6px; right:-6px }

    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="titleRow">
      <div class="logo"></div>
      <div>
        <h1>è¨˜å¸³ Â· åœ“å½¢å‹•æ…‹æ¥µç°¡ v3.2</h1>
        <div class="tagline" id="tagline">å°åœ“éˆ•ï¼Œå¤§æˆæ•ˆã€‚</div>
      </div>
      <div style="margin-left:auto">
        <button class="circle ghost mini" id="btnSettings" title="ä¸»é¡Œ / é¢¨æ ¼">âš™ï¸</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>æ–°å¢äº¤æ˜“ <span class="chip">åœ“å½¢æ“ä½œ</span></h2>
        <div class="row">
          <div>
            <label>æ—¥æœŸ</label>
            <input type="date" id="date" />
          </div>
          <div>
            <label>æ”¶æ”¯</label>
            <select id="type">
              <option value="expense">æ”¯å‡º</option>
              <option value="income">æ”¶å…¥</option>
            </select>
          </div>
          <div>
            <label>åˆ†é¡</label>
            <!-- é è¨­æ”¾å…¥åŸºæœ¬é¸é …ï¼Œç¢ºä¿ä¸€å®šå¯é» -->
            <select id="category">
              <option value="é£Ÿç‰©">é£Ÿç‰©</option>
              <option value="äº¤é€š">äº¤é€š</option>
              <option value="å¨›æ¨‚">å¨›æ¨‚</option>
              <option value="è³¼ç‰©">è³¼ç‰©</option>
              <option value="ä½æˆ¿">ä½æˆ¿</option>
              <option value="æ°´é›»ç“¦æ–¯">æ°´é›»ç“¦æ–¯</option>
              <option value="é†«ç™‚">é†«ç™‚</option>
              <option value="æ•™è‚²">æ•™è‚²</option>
              <option value="ç¨…é‡‘">ç¨…é‡‘</option>
              <option value="å…¶ä»–" selected>å…¶ä»–</option>
              <option value="è‡ªè¨‚åˆ†é¡â€¦">è‡ªè¨‚åˆ†é¡â€¦</option>
            </select>
          </div>
          <div>
            <label>å¸³æˆ¶</label>
            <select id="account">
              <option>ç¾é‡‘</option>
              <option>ä¿¡ç”¨å¡</option>
              <option>é‡‘èå¡</option>
              <option>é›»å­æ”¯ä»˜</option>
              <option>å…¶ä»–</option>
            </select>
          </div>
          <div>
            <label>é‡‘é¡ï¼ˆTWDï¼‰</label>
            <input type="number" id="amount" step="0.01" placeholder="0" />
          </div>
          <div style="flex:1 1 100%">
            <label>å‚™è¨»</label>
            <input type="text" id="note" placeholder="å¯è¼¸å…¥åº—å®¶ã€äº‹é …ã€æ¨™ç±¤â€¦" />
          </div>
        </div>
        <div class="toolrow">
          <button class="circle ok" id="btnAdd" data-title="æ–°å¢">â•</button>
          <button class="circle secondary" id="btnQuick" data-title="å¿«é€Ÿæ–°å¢ï¼šä»Šæ—¥é›¶ç”¨ $100">ğŸš€</button>
        </div>

        <hr style="border:none; border-top:1px solid var(--line); margin:12px 0">

        <h2>ç¯©é¸ / ç¸½è¦½</h2>
        <div class="row">
          <div>
            <label>é–‹å§‹æ—¥æœŸ</label>
            <input type="date" id="fStart" />
          </div>
          <div>
            <label>çµæŸæ—¥æœŸ</label>
            <input type="date" id="fEnd" />
          </div>
          <div>
            <label>æ”¶æ”¯</label>
            <select id="fType">
              <option value="all">å…¨éƒ¨</option>
              <option value="expense">æ”¯å‡º</option>
              <option value="income">æ”¶å…¥</option>
            </select>
          </div>
          <div>
            <label>åˆ†é¡</label>
            <select id="fCategory"></select>
          </div>
          <div style="flex: 1 1 100%">
            <label>é—œéµå­—ï¼ˆå‚™è¨»/å¸³æˆ¶ï¼‰</label>
            <input type="text" id="fKeyword" placeholder="ä¾‹å¦‚ï¼šè¶…å•†ã€åˆé¤ã€æˆ¿ç§Ÿâ€¦" />
          </div>
        </div>
        <div class="toolrow">
          <button class="circle" id="btnFilter" title="å¥—ç”¨ç¯©é¸">ğŸ”</button>
          <button class="circle ghost" id="btnReset" title="æ¸…é™¤ç¯©é¸">â™»ï¸</button>
          <div class="segs" id="segWrap">
            <div class="seg" data-range="today">ä»Šæ—¥</div>
            <div class="seg active" data-range="month">æœ¬æœˆ</div>
            <div class="seg" data-range="year">ä»Šå¹´</div>
            <div class="seg" data-range="all">å…¨éƒ¨</div>
          </div>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="label">æ”¶å…¥ï¼ˆæœŸé–“ï¼‰</div>
            <div class="val" id="statInc">â€”</div>
          </div>
          <div class="stat">
            <div class="label">æ”¯å‡ºï¼ˆæœŸé–“ï¼‰</div>
            <div class="val" id="statExp">â€”</div>
          </div>
          <div class="stat">
            <div class="label">æ·¨é¡ï¼ˆæœŸé–“ï¼‰</div>
            <div class="val" id="statNet">â€”</div>
          </div>
        </div>

        <details id="chartsBox" open>
          <summary>åœ–è¡¨ï¼ˆåˆ†é¡åœ“é¤… / èµ°å‹¢æŠ˜ç·šï¼‰</summary>
          <div class="row" style="margin-top:10px">
            <div style="flex:1 1 280px"><canvas id="pie"></canvas></div>
            <div style="flex:1 1 280px"><canvas id="line"></canvas></div>
          </div>
        </details>

        <details id="recycleBin">
          <summary>å›æ”¶æ¡¶ / é‚„åŸ</summary>
          <div class="tableWrap" style="margin-top:10px">
            <table>
              <thead>
                <tr>
                  <th style="width:180px">æ™‚é–“</th>
                  <th>å…§å®¹</th>
                  <th style="width:240px">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="backupTbody"></tbody>
            </table>
          </div>
        </details>
      </div>
